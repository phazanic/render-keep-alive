name: Keep Render Services Alive

# ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
on:
  schedule:
    # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å 10 ‡∏ô‡∏≤‡∏ó‡∏µ (UTC time)
    # ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ = UTC +7
    # 23:00-16:00 UTC = 06:00-23:00 ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢
    - cron: '*/10 23,0-16 * * *'
  
  # ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡πÅ‡∏ö‡∏ö manual ‡πÑ‡∏î‡πâ
  workflow_dispatch:

jobs:
  ping-services:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup timezone
        uses: szenius/set-timezone@v1.2
        with:
          timezoneLinux: "Asia/Bangkok"
      
      - name: Current time
        run: echo "Current time - $(date)"
      
      - name: Ping n8n on Render
        run: |
          echo "üèì Pinging n8n..."
          response=$(curl -s -o /dev/null -w "%{http_code}" https://n8n-1se2.onrender.com)
          echo "Response code: $response"
          
          if [ $response -eq 200 ]; then
            echo "‚úÖ n8n is alive!"
          else
            echo "‚ö†Ô∏è n8n returned code $response"
          fi
      
      - name: Wait 5 seconds
        run: sleep 5
      
      - name: Ping webhook endpoint
        run: |
          echo "üèì Pinging webhook..."
          response=$(curl -s -o /dev/null -w "%{http_code}" -X POST \
            -H "Content-Type: application/json" \
            -d '{"ping": true}' \
            https://your-n8n-app.onrender.com/webhook/nutrition)
          echo "Webhook response: $response"
      
      - name: Summary
        run: |
          echo "‚úÖ Keep alive completed at $(date)"
          echo "Next run in 10 minutes..."
